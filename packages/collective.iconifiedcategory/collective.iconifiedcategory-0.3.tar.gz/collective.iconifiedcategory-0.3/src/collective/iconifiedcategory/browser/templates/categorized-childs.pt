<tal:defines define="can_view view/can_view">
  <tal:if i18n:domain="collective.iconifiedcategory" condition="can_view">
  <tal:block repeat="category view/categories_ids"
             define="infos view/infos;
                     portal_url view/portal_url">
  <div id="" style="display: none;" tal:attributes="id string:${category}_${context/UID|context/getId}">
    <ul>
      <li tal:repeat="element python: infos[category]">
        <tal:block define="element_url python:element['download_url'] and element['download_url'] or element['relative_url']">
        <a href="" tal:attributes="href string:${portal_url}/${element_url}">
          <img src="" alt="" tal:attributes="src string:${portal_url}/${element/icon_url};
                                             alt element/category_title;
                                             title element/category_title" />
          <span tal:content="element/title"
                tal:attributes="title element/description"></span>
          <tal:filesize tal:condition="element/warn_filesize">
            (<span tal:replace="structure python: view.render_filesize(size=element['filesize'])">File size warning</span>)
          </tal:filesize>
        </a>
        <tal:if condition="python: view.showPreviewLink() and element['preview_status'] == 'converted'">
        <a href=""
           title="Preview"
           i18n:attributes="title"
           target="_blank"
           tal:attributes="href string:${portal_url}/${element/relative_url}/documentviewer#document/p1">
          <img src=""
               tal:attributes="src string:${portal_url}/file_icon.png" />
        </a>
        </tal:if>
        </tal:block>
      </li>
    </ul>
    <br />
    <a href="#"
       target="_parent"
       tal:attributes="href view/categorized_elements_more_infos_url">
      <img class="categorized_elements_more_infos_icon"
           src="more_infos.png"
           tal:attributes="src string:${portal_url}/++resource++collective.iconifiedcategory.more_infos.png" />
      <span i18n:translate="">More infos</span>
    </a>
  </div>
  </tal:block>

  <div class="categorized-elements" tal:define="cat_infos view/categories_infos">
    <tal:block repeat="element cat_infos">
      <a href="" class="tooltip deactivated"
         onclick="javascript:event.preventDefault();"
         tal:attributes="href string:#${element/id}_${context/UID|context/getId};
                         title element/title">
        <span tal:content="element/counts"></span>
        <img src=""
             alt=""
             tal:attributes="src string:${view/portal_url}/${element/icon};
                             alt element/title;
                             title element/title" />
      </a>
    </tal:block>
    <div style="clear: both;"></div>
  </div>
  </tal:if>

  <tal:nothing condition="not:can_view">
    <span class="discreet" i18n:translate="">Nothing.</span>
  </tal:nothing>
</tal:defines>
