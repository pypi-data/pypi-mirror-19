

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Power tools &mdash; csvkit 1.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="csvkit 1.0.0 documentation" href="../index.html"/>
        <link rel="up" title="Tutorial" href="../tutorial.html"/>
        <link rel="next" title="4. Going elsewhere with your data" href="4_going_elsewhere.html"/>
        <link rel="prev" title="2. Examining the data" href="2_examining_the_data.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> csvkit
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_getting_started.html">1. Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_examining_the_data.html">2. Examining the data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">3. Power tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#csvjoin-merging-related-data">3.1. csvjoin: merging related data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csvstack-combining-subsets">3.2. csvstack: combining subsets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csvsql-and-sql2csv-ultimate-power">3.3. csvsql and sql2csv: ultimate power</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summing-up">3.4. Summing up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="4_going_elsewhere.html">4. Going elsewhere with your data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tricks.html">Tips and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to csvkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release process</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">csvkit</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../tutorial.html">Tutorial</a> &raquo;</li>
      
    <li>3. Power tools</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial/3_power_tools.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="power-tools">
<h1>3. Power tools<a class="headerlink" href="#power-tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="csvjoin-merging-related-data">
<h2>3.1. csvjoin: merging related data<a class="headerlink" href="#csvjoin-merging-related-data" title="Permalink to this headline">¶</a></h2>
<p>One of the most common operations that we need to perform on data is &#8220;joining&#8221; it to other, related data. For instance, given a dataset about equipment supplied to counties in Nebraska, one might reasonably want to merge that with a dataset containing the population of each county. <a class="reference internal" href="../scripts/csvjoin.html"><em>csvjoin</em></a> allows us to take two those two datasets (equipment and population) and merge them, much like you might do with a SQL <code class="docutils literal"><span class="pre">JOIN</span></code> query. In order to demonstrate this, let&#8217;s grab a second dataset:</p>
<div class="highlight-python"><div class="highlight"><pre>.. code-block:: bash
</pre></div>
</div>
<blockquote>
<div>curl -L -O <a class="reference external" href="https://raw.githubusercontent.com/wireservice/csvkit/master/examples/realdata/acs2012_5yr_population.csv">https://raw.githubusercontent.com/wireservice/csvkit/master/examples/realdata/acs2012_5yr_population.csv</a></div></blockquote>
<p>Now let&#8217;s see what&#8217;s in there:</p>
<div class="highlight-bash"><div class="highlight"><pre>csvstat acs2012_5yr_population.csv
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>1. fips
  Number
  Nulls: False
  Min: 31001
  Max: 31185
  Sum: 2891649
  Mean: 31093
  Median: 31093
  Standard Deviation: 53.98147830506311726900562525
  Unique values: 93
  5 most frequent values:
      31001:        1
      31003:        1
      31005:        1
      31007:        1
      31009:        1
2. name
  Text
  Nulls: False
  Unique values: 93
  Max length: 23
  5 most frequent values:
      Adams County, NE:     1
      Antelope County, NE:  1
      Arthur County, NE:    1
      Banner County, NE:    1
      Blaine County, NE:    1
3. total_population
  Number
  Nulls: False
  Min: 348
  Max: 518271
  Sum: 1827306
  Mean: 19648.45161290322580645161290
  Median: 6294
  Standard Deviation: 62501.00530730896711321285542
  Unique values: 93
  5 most frequent values:
      31299:        1
      6655: 1
      490:  1
      778:  1
      584:  1
4. margin_of_error
  Number
  Nulls: False
  Min: 0
  Max: 115
  Sum: 1800
  Mean: 19.35483870967741935483870968
  Median: 0
  Standard Deviation: 37.89707031274211909117708454
  Unique values: 15
  5 most frequent values:
      0:    73
      73:   2
      114:  2
      97:   2
      99:   2

Row count: 93
</pre></div>
</div>
<p>As you can see, this data file contains population estimates for each county in Nebraska from the 2012 5-year ACS estimates. This data was retrieved from <a class="reference external" href="http://censusreporter.org/">Census Reporter</a> and reformatted slightly for this example. Let&#8217;s join it to our equipment data:</p>
<div class="highlight-bash"><div class="highlight"><pre>csvjoin -c fips data.csv acs2012_5yr_population.csv &gt; joined.csv
</pre></div>
</div>
<p>Since both files contain a fips column, we can use that to join the two. In our output you should see the population data appended at the end of each row of data. Let&#8217;s combine this with what we&#8217;ve learned before to answer the question &#8220;What was the lowest population county to receive equipment?&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre>csvcut -c county,item_name,total_population joined.csv <span class="p">|</span> csvsort -c total_population <span class="p">|</span> csvlook <span class="p">|</span> head
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="p">|</span> county     <span class="p">|</span> item_name                                                      <span class="p">|</span> total_population <span class="p">|</span>
<span class="p">|</span> ---------- <span class="p">|</span> -------------------------------------------------------------- <span class="p">|</span> ---------------- <span class="p">|</span>
<span class="p">|</span> MCPHERSON  <span class="p">|</span> RIFLE,5.56 MILLIMETER                                          <span class="p">|</span>              <span class="m">348</span> <span class="p">|</span>
<span class="p">|</span> WHEELER    <span class="p">|</span> RIFLE,5.56 MILLIMETER                                          <span class="p">|</span>              <span class="m">725</span> <span class="p">|</span>
<span class="p">|</span> GREELEY    <span class="p">|</span> RIFLE,7.62 MILLIMETER                                          <span class="p">|</span>            2,515 <span class="p">|</span>
<span class="p">|</span> GREELEY    <span class="p">|</span> RIFLE,7.62 MILLIMETER                                          <span class="p">|</span>            2,515 <span class="p">|</span>
<span class="p">|</span> GREELEY    <span class="p">|</span> RIFLE,7.62 MILLIMETER                                          <span class="p">|</span>            2,515 <span class="p">|</span>
<span class="p">|</span> NANCE      <span class="p">|</span> RIFLE,5.56 MILLIMETER                                          <span class="p">|</span>            3,730 <span class="p">|</span>
<span class="p">|</span> NANCE      <span class="p">|</span> RIFLE,7.62 MILLIMETER                                          <span class="p">|</span>            3,730 <span class="p">|</span>
<span class="p">|</span> NANCE      <span class="p">|</span> RIFLE,7.62 MILLIMETER                                          <span class="p">|</span>            3,730 <span class="p">|</span>
</pre></div>
</div>
<p>Two counties with fewer than one-thousand residents were the recipients of 5.56 millimeter assault rifles. This simple example demonstrates the power of joining datasets. Although SQL will always be a more flexible option, <code class="docutils literal"><span class="pre">csvjoin</span></code> will often get you where you need to go faster.</p>
</div>
<div class="section" id="csvstack-combining-subsets">
<h2>3.2. csvstack: combining subsets<a class="headerlink" href="#csvstack-combining-subsets" title="Permalink to this headline">¶</a></h2>
<p>Frequently large datasets are distributed in many small files. At some point you will probably want to merge those files for bulk analysis. <a class="reference internal" href="../scripts/csvstack.html"><em>csvstack</em></a> allows you to &#8220;stack&#8221; the rows from CSV files with the same columns (and identical column names). To demonstrate, let&#8217;s imagine we&#8217;ve decided that Nebraska and Kansas form a &#8220;region&#8221; and that it would be useful to analyze them in a single dataset. Let&#8217;s grab the Kansas data:</p>
<div class="highlight-bash"><div class="highlight"><pre>curl -L -O https://raw.githubusercontent.com/wireservice/csvkit/master/examples/realdata/ks_1033_data.csv
</pre></div>
</div>
<p>Back in <a class="reference internal" href="1_getting_started.html"><em>Getting started</em></a>, we had used in2csv to convert our Nebraska data from XLSX to CSV. However, we named our output <cite>data.csv</cite> for simplicity at the time. Now that we are going to be stacking multiple states, we should re-convert our Nebraska data using a file naming convention matching our Kansas data:</p>
<div class="highlight-bash"><div class="highlight"><pre>in2csv ne_1033_data.xlsx &gt; ne_1033_data.csv
</pre></div>
</div>
<p>Now let&#8217;s stack these two data files:</p>
<div class="highlight-bash"><div class="highlight"><pre>csvstack ne_1033_data.csv ks_1033_data.csv &gt; region.csv
</pre></div>
</div>
<p>Using csvstat we can see that our <code class="docutils literal"><span class="pre">region.csv</span></code> contains both datasets:</p>
<div class="highlight-bash"><div class="highlight"><pre>csvstat -c state,acquisition_cost region.csv
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre>1. state
  Text
  Nulls: False
  Values: NE, KS
  Max length: 2
  <span class="m">5</span> most frequent values:
      KS:   1575
      NE:   1036
8. acquisition_cost
  Number
  Nulls: False
  Min: 0.0
  Max: 658000
  Sum: 9440445.91
  Mean: 3615.643780160857908847184987
  Median: 138
  Standard Deviation: 23730.63142202547205726466358
  Unique values: 127
  <span class="m">5</span> most frequent values:
      120.0:        649
      499.0:        449
      138.0:        311
      6800.0:       304
      58.71:        218

Row count: 2611
</pre></div>
</div>
<p>If you supply the <code class="docutils literal"><span class="pre">-g</span></code> flag then <code class="docutils literal"><span class="pre">csvstack</span></code> can also add a &#8220;grouping column&#8221; to each row, so that you can tell which file each row came from. In this case we don&#8217;t need this, but you can imagine a situation in which instead of having a <code class="docutils literal"><span class="pre">county</span></code> column each of this datasets had simply been named <code class="docutils literal"><span class="pre">nebraska.csv</span></code> and <code class="docutils literal"><span class="pre">kansas.csv</span></code>. In that case, using a grouping column would prevent us from losing information when we stacked them.</p>
</div>
<div class="section" id="csvsql-and-sql2csv-ultimate-power">
<h2>3.3. csvsql and sql2csv: ultimate power<a class="headerlink" href="#csvsql-and-sql2csv-ultimate-power" title="Permalink to this headline">¶</a></h2>
<p>Sometimes (almost always), the command-line isn&#8217;t enough. It would be crazy to try to do all your analysis using command-line tools. Often times, the correct tool for data analysis is SQL. <a class="reference internal" href="../scripts/csvsql.html"><em>csvsql</em></a> and <a class="reference internal" href="../scripts/sql2csv.html"><em>sql2csv</em></a> form a bridge that eases migrating your data into and out of a SQL database. For smaller datasets <code class="docutils literal"><span class="pre">csvsql</span></code> can also leverage <a class="reference external" href="https://www.sqlite.org/">sqlite</a> to allow execution of ad hoc SQL queries without ever touching a database.</p>
<p>By default, <code class="docutils literal"><span class="pre">csvsql</span></code> will generate a create table statement for your data. You can specify what sort of database you are using with the <code class="docutils literal"><span class="pre">-i</span></code> flag:</p>
<div class="highlight-python"><div class="highlight"><pre>.. code-block:: bash
</pre></div>
</div>
<blockquote>
<div>csvsql -i sqlite joined.csv</div></blockquote>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">joined</span> <span class="p">(</span>
        <span class="k">state</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">county</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">fips</span> <span class="nb">DECIMAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">nsn</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">item_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">62</span><span class="p">),</span>
        <span class="n">quantity</span> <span class="nb">DECIMAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">ui</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">acquisition_cost</span> <span class="nb">DECIMAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">total_cost</span> <span class="nb">DECIMAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">ship_date</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">federal_supply_category</span> <span class="nb">DECIMAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">federal_supply_category_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">federal_supply_class</span> <span class="nb">DECIMAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">federal_supply_class_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">63</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">total_population</span> <span class="nb">DECIMAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">margin_of_error</span> <span class="nb">DECIMAL</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Here we have the sqlite &#8220;create table&#8221; statement for our joined data. You&#8217;ll see that, like <code class="docutils literal"><span class="pre">csvstat</span></code>, <code class="docutils literal"><span class="pre">csvsql</span></code> has done its best to infer the column types.</p>
<p>Often you won&#8217;t care about storing the SQL statements locally. You can also use <code class="docutils literal"><span class="pre">csvsql</span></code> to create the table directly in the database on your local machine. If you add the <code class="docutils literal"><span class="pre">--insert</span></code> option the data will also be imported:</p>
<div class="highlight-bash"><div class="highlight"><pre>csvsql --db sqlite:///leso.db --insert joined.csv
</pre></div>
</div>
<p>How can we check that our data was imported successfully? We could use the sqlite command-line interface, but rather than worry about the specifics of another tool, we can also use <code class="docutils literal"><span class="pre">sql2csv</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre>sql2csv --db sqlite:///leso.db --query <span class="s2">&quot;select * from joined&quot;</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal"><span class="pre">--query</span></code> parameter to <code class="docutils literal"><span class="pre">sql2csv</span></code> accepts any SQL query. For example, to export Douglas county from the <code class="docutils literal"><span class="pre">joined</span></code> table from our sqlite database, we would run:</p>
<div class="highlight-bash"><div class="highlight"><pre>sql2csv --db sqlite:///leso.db --query <span class="s2">&quot;select * from joined where county=&#39;DOUGLAS&#39;;&quot;</span> &gt; douglas.csv
</pre></div>
</div>
<p>Sometimes, if you will only be running a single query, even constructing the database is a waste of time. For that case, you can actually skip the database entirely and <code class="docutils literal"><span class="pre">csvsql</span></code> will create one in memory for you:</p>
<div class="highlight-bash"><div class="highlight"><pre>csvsql --query <span class="s2">&quot;select county,item_name from joined where quantity &gt; 5;&quot;</span> joined.csv <span class="p">|</span> csvlook
</pre></div>
</div>
<p>SQL queries directly on CSVs! Keep in mind when using this that you are loading the entire dataset into an in-memory database, so it is likely to be very slow for large datasets.</p>
</div>
<div class="section" id="summing-up">
<h2>3.4. Summing up<a class="headerlink" href="#summing-up" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">csvjoin</span></code>, <code class="docutils literal"><span class="pre">csvstack</span></code>, <code class="docutils literal"><span class="pre">csvsql</span></code> and <code class="docutils literal"><span class="pre">sql2csv</span></code> represent the power tools of csvkit. Using these tools can vastly simplify processes that would otherwise require moving data between other systems. But what about cases where these tools still don&#8217;t cut it? What if you need to move your data onto the web or into a legacy database system? We&#8217;ve got a few solutions for those problems in our final section, <a class="reference internal" href="4_going_elsewhere.html"><em>Going elsewhere with your data</em></a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="4_going_elsewhere.html" class="btn btn-neutral float-right" title="4. Going elsewhere with your data" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="2_examining_the_data.html" class="btn btn-neutral" title="2. Examining the data" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Christopher Groskopf.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>