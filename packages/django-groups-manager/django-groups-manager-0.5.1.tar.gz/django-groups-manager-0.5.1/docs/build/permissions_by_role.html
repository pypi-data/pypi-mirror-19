

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Resource assignment via role permissions &mdash; Django Groups Manager 0.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Django Groups Manager 0.3.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Django Groups Manager
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#basic-usage">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth_integration.html">Django auth models integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_cases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Django Groups Manager</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Resource assignment via role permissions</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/permissions_by_role.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="resource-assignment-via-role-permissions">
<span id="custom-permissions-by-role"></span><h1>Resource assignment via role permissions<a class="headerlink" href="#resource-assignment-via-role-permissions" title="Permalink to this headline">Â¶</a></h1>
<p>John Money is the commercial referent of the company; Patrick Html is the web
developer. The company has only one group, but different roles.
John can view and sell the site, and Patrick can view, change and delete the site.</p>
<p><strong>1) Define models in models.py</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Site</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;view_site&#39;</span><span class="p">,</span> <span class="s1">&#39;View site&#39;</span><span class="p">),</span>
                       <span class="p">(</span><span class="s1">&#39;sell_site&#39;</span><span class="p">,</span> <span class="s1">&#39;Sell site&#39;</span><span class="p">),</span> <span class="p">)</span>
</pre></div>
</div>
<p><strong>2) Create models and relations</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">groups_manager.models</span> <span class="k">import</span> <span class="n">Group</span><span class="p">,</span> <span class="n">GroupMemberRole</span><span class="p">,</span> <span class="n">Member</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="k">import</span> <span class="n">Site</span>
<span class="c1"># Group</span>
<span class="n">company</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Company&#39;</span><span class="p">)</span>
<span class="c1"># Group Member roles</span>
<span class="n">commercial_referent</span> <span class="o">=</span> <span class="n">GroupMemberRole</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Commercial referent&#39;</span><span class="p">)</span>
<span class="n">web_developer</span> <span class="o">=</span> <span class="n">GroupMemberRole</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Web developer&#39;</span><span class="p">)</span>
<span class="c1"># Members</span>
<span class="n">john</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Money&#39;</span><span class="p">)</span>
<span class="n">patrick</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;Patrick&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Html&#39;</span><span class="p">)</span>
<span class="c1"># Add to company</span>
<span class="n">company</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">john</span><span class="p">,</span> <span class="p">[</span><span class="n">commercial_referent</span><span class="p">])</span>
<span class="n">company</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">patrick</span><span class="p">,</span> <span class="p">[</span><span class="n">web_developer</span><span class="p">])</span>
<span class="c1"># Create the site</span>
<span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Django groups manager website&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>3) Define custom permissions and assign the site object</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">custom_permissions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;commercial-referent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sell_site&#39;</span><span class="p">],</span>
              <span class="s1">&#39;web-developer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">],</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">]},</span>
    <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">],</span>
    <span class="s1">&#39;groups_upstream&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">],</span>
    <span class="s1">&#39;groups_downstream&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">],</span>
    <span class="s1">&#39;groups_siblings&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">john</span><span class="o">.</span><span class="n">assign_object</span><span class="p">(</span><span class="n">company</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">custom_permissions</span><span class="o">=</span><span class="n">custom_permissions</span><span class="p">)</span>
<span class="n">patrick</span><span class="o">.</span><span class="n">assign_object</span><span class="p">(</span><span class="n">company</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">custom_permissions</span><span class="o">=</span><span class="n">custom_permissions</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>4) Check permissions</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">john</span><span class="o">.</span><span class="n">has_perms</span><span class="p">([</span><span class="s1">&#39;view_site&#39;</span><span class="p">,</span> <span class="s1">&#39;sell_site&#39;</span><span class="p">],</span> <span class="n">site</span><span class="p">)</span>  <span class="c1"># True</span>
<span class="n">john</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;change_site&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>  <span class="c1"># False</span>
<span class="n">patrick</span><span class="o">.</span><span class="n">has_perms</span><span class="p">([</span><span class="s1">&#39;view_site&#39;</span><span class="p">,</span> <span class="s1">&#39;change_site&#39;</span><span class="p">,</span> <span class="s1">&#39;delete_site&#39;</span><span class="p">],</span> <span class="n">site</span><span class="p">)</span>  <span class="c1"># True</span>
<span class="n">patrick</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;sell_site&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>  <span class="c1"># False</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The full tested example is available in repository source code, <code class="docutils literal"><span class="pre">testproject</span></code>&#8216;s <code class="docutils literal"><span class="pre">tests.py</span></code> under <code class="docutils literal"><span class="pre">test_roles</span></code> method.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Vittorio Zamboni.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>