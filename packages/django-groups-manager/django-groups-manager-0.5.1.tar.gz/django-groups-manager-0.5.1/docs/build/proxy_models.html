

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Projects management with Proxy Models &mdash; Django Groups Manager 0.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Django Groups Manager 0.3.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Django Groups Manager
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#basic-usage">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth_integration.html">Django auth models integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_cases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Django Groups Manager</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Projects management with Proxy Models</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/proxy_models.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="projects-management-with-proxy-models">
<h1>Projects management with Proxy Models<a class="headerlink" href="#projects-management-with-proxy-models" title="Permalink to this headline">Â¶</a></h1>
<p>John Boss is the project leader. Marcus Worker and Julius Backend are the
django backend guys; Teresa Html is the front-end developer and Jack College is the
student that has to learn to write good backends.
The Celery pipeline is owned by Marcus, and Jack must see it without intercations.
Teresa can&#8217;t see the pipeline, but John has full permissions as project leader.
As part of the backend group, Julius has the right of viewing and editing, but not to
stop (delete) the pipeline.</p>
<p><strong>1) Define models in models.py</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">groups_manager.models</span> <span class="k">import</span> <span class="n">Group</span><span class="p">,</span> <span class="n">GroupType</span>

<span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>
    <span class="c1"># objects = ProjectManager()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_type</span> <span class="o">=</span> <span class="n">GroupType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Project&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Project</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">WorkGroup</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>
    <span class="c1"># objects = WorkGroupManager()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_type</span> <span class="o">=</span> <span class="n">GroupType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Workgroup&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WorkGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Pipeline</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;view_pipeline&#39;</span><span class="p">,</span> <span class="s1">&#39;View Pipeline&#39;</span><span class="p">),</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Remember to define a <code class="docutils literal"><span class="pre">view_modelname</span></code> permission.</p>
</div>
<p><strong>2) Connect creation and deletion signals to the proxy models</strong>
<em>(This step is required if you want to sync with django auth models)</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="k">import</span> <span class="n">post_save</span><span class="p">,</span> <span class="n">post_delete</span>
<span class="kn">from</span> <span class="nn">groups_manager.models</span> <span class="k">import</span> <span class="n">group_save</span><span class="p">,</span> <span class="n">group_delete</span>

<span class="n">post_save</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">group_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">Project</span><span class="p">)</span>
<span class="n">post_delete</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">group_delete</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">Project</span><span class="p">)</span>
<span class="n">post_save</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">group_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">WorkGroup</span><span class="p">)</span>
<span class="n">post_delete</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">group_delete</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">WorkGroup</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>3) Creates groups</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">project_main</span> <span class="o">=</span> <span class="n">testproject_models</span><span class="o">.</span><span class="n">Project</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Workgroups Main Project&#39;</span><span class="p">)</span>
<span class="n">project_main</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">django_backend</span> <span class="o">=</span> <span class="n">testproject_models</span><span class="o">.</span><span class="n">WorkGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;WorkGroup Backend&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">project_main</span><span class="p">)</span>
<span class="n">django_backend</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">django_backend_watchers</span> <span class="o">=</span> <span class="n">testproject_models</span><span class="o">.</span><span class="n">WorkGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Backend Watchers&#39;</span><span class="p">,</span>
                                                    <span class="n">parent</span><span class="o">=</span><span class="n">django_backend</span><span class="p">)</span>
<span class="n">django_backend_watchers</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">django_frontend</span> <span class="o">=</span> <span class="n">testproject_models</span><span class="o">.</span><span class="n">WorkGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;WorkGroup FrontEnd&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">project_main</span><span class="p">)</span>
<span class="n">django_frontend</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>4) Creates members and assign them to groups</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">john</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Boss&#39;</span><span class="p">)</span>
<span class="n">project_main</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">john</span><span class="p">)</span>
<span class="n">marcus</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;Marcus&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Worker&#39;</span><span class="p">)</span>
<span class="n">julius</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;Julius&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Backend&#39;</span><span class="p">)</span>
<span class="n">django_backend</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">marcus</span><span class="p">)</span>
<span class="n">django_backend</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">julius</span><span class="p">)</span>
<span class="n">teresa</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;Teresa&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Html&#39;</span><span class="p">)</span>
<span class="n">django_frontend</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">teresa</span><span class="p">)</span>
<span class="n">jack</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;Jack&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;College&#39;</span><span class="p">)</span>
<span class="n">django_backend_watchers</span><span class="o">.</span><span class="n">add_member</span><span class="p">(</span><span class="n">jack</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>5) Create the pipeline and assign custom permissions</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">custom_permissions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">],</span>
    <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">],</span>
    <span class="s1">&#39;groups_upstream&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">],</span>
    <span class="s1">&#39;groups_downstream&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">],</span>
    <span class="s1">&#39;groups_siblings&#39;</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">}</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">testproject_models</span><span class="o">.</span><span class="n">Pipeline</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Test Runner&#39;</span><span class="p">)</span>
<span class="n">marcus</span><span class="o">.</span><span class="n">assing_object</span><span class="p">(</span><span class="n">django_backend</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">custom_permissions</span><span class="o">=</span><span class="n">custom_permissions</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The full tested example is available in repository source code, <code class="docutils literal"><span class="pre">testproject</span></code>&#8216;s <code class="docutils literal"><span class="pre">tests.py</span></code> under <code class="docutils literal"><span class="pre">test_proxy_models</span></code> method.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Vittorio Zamboni.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>