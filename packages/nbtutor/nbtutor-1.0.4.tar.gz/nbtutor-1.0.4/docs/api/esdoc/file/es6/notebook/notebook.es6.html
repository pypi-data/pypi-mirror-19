<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">es6/notebook/notebook.es6 | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">data</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/data/frame_timeline.es6~FrameTimeline.html">FrameTimeline</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/data/heap_history.es6~HeapHistory.html">HeapHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/data/output_history.es6~OutputHistory.html">OutputHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/data/stack_history.es6~StackHistory.html">StackHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/data/stack_timeline.es6~StackTimeline.html">StackTimeline</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/data/trace_history.es6~TraceHistory.html">TraceHistory</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">notebook</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/notebook/gutters.es6~GutterMarkers.html">GutterMarkers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/notebook/notebook.es6~VisualizedCell.html">VisualizedCell</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/notebook/toolbar.es6~Toolbar.html">Toolbar</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">render</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/render/html_memory.es6~MemoryModelUI.html">MemoryModelUI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/es6/render/html_timeline.es6~TimelineUI.html">TimelineUI</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">es6/notebook/notebook.es6</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">
import {$, d3, uuid} from &quot;nbtutor-deps&quot;;

import {Toolbar} from &quot;./toolbar&quot;;
import {GutterMarkers} from &quot;./gutters&quot;;
import {TraceHistory} from &quot;../data/trace_history&quot;;
import {StackTimeline} from &quot;../data/stack_timeline&quot;;
import {MemoryModelUI} from &quot;../render/html_memory&quot;;
import {TimelineUI} from &quot;../render/html_timeline&quot;;

import dialog from &quot;base/js/dialog&quot;;
import events from &quot;base/js/events&quot;;
import Jupyter from &quot;base/js/namespace&quot;;


function alertUserMissingData(){
    let msg = $(&quot;&lt;p/&gt;&quot;).text(
        &quot;No visualization data was found for this cell. &quot; +
        &quot;Please include the following magic at the start &quot; +
        &quot;of the cell and run the code again:&quot;
    ).append($(&quot;&lt;pre/&gt;&quot;).text(
        &quot;%%nbtutor&quot;
    ));

    dialog.modal({
        notebook: Jupyter.notebook,
        keyboard_manager: Jupyter.notebook.keyboard_manager,
        title: &quot;Missing Visualization Data&quot;,
        body: msg,
        buttons: {
            OK: {}
        }
    });
}


export class VisualizedCell {
    constructor(cell){
        this.tracestep = 0;
        this.trace_history = new TraceHistory(cell);
        this.stack_timeline = new StackTimeline();

        this.cell = cell;
        this.codemirror = cell.code_mirror;
        this.output_area = this.cell.output_area;

        this.$input_area = cell.element.find(&quot;.input_area&quot;)
            .addClass(&quot;nbtutor-input-area&quot;);
        this.$nbtutor_canvas = $(&quot;&lt;div/&gt;&quot;)
            .attr(&quot;class&quot;, &quot;nbtutor-canvas&quot;)
            .attr(&quot;id&quot;, &quot;c-&quot; + uuid.v4())
            .addClass(&quot;nbtutor-hidden&quot;);
        this.d3Root = d3.select(this.$nbtutor_canvas.toArray()[0]);

        this.toolbar = new Toolbar(cell);
        this.markers = new GutterMarkers(cell);
        this.memoryUI = new MemoryModelUI(this.trace_history, this.d3Root);
        this.timelineUI = new TimelineUI(this.stack_timeline, this.d3Root);

        // Build the UI elements
        this._build();
    }

    _checkData(){
        // Alert if no data
        if (!this.trace_history || !this.trace_history.stack_history){
            this.toolbar.$select_view.val(&quot;none&quot;).trigger(&quot;change&quot;);
            alertUserMissingData();
        }
    }

    _bindButtons(){
        let that = this;

        this.toolbar.$btn_first.on(&quot;click&quot;, () =&gt; {
            let stack_history = this.trace_history.stack_history;
            let heap_history = this.trace_history.heap_history;

            that._checkData();
            that.tracestep = 0;
            that.stack_timeline.clear();
            that.stack_timeline.push(
                stack_history.getStackFrames(that.tracestep),
                heap_history.getHeapObjects(that.tracestep)
            );
            that.visualize();
        });

        this.toolbar.$btn_prev.on(&quot;click&quot;, () =&gt; {
            if (that.tracestep &gt; 0){
                that._checkData();
                that.tracestep -= 1;
                that.stack_timeline.pop();
                that.visualize();
            }
        });

        this.toolbar.$btn_next.on(&quot;click&quot;, () =&gt; {
            if (that.tracestep &lt; that.trace_history.tracesteps-1){
                let stack_history = this.trace_history.stack_history;
                let heap_history = this.trace_history.heap_history;

                that._checkData();
                that.tracestep += 1;
                that.stack_timeline.push(
                    stack_history.getStackFrames(that.tracestep),
                    heap_history.getHeapObjects(that.tracestep)
                );
                that.visualize();
            }
        });

        this.toolbar.$btn_last.on(&quot;click&quot;, () =&gt; {
            let stack_history = this.trace_history.stack_history;
            let heap_history = this.trace_history.heap_history;

            that._checkData();
            that.stack_timeline.clear();
            that.tracestep = that.trace_history.tracesteps-1;
            for (let tracestep=0; tracestep&lt;that.tracestep+1; tracestep++){
                that.stack_timeline.push(
                    stack_history.getStackFrames(tracestep),
                    heap_history.getHeapObjects(tracestep)
                );
            }
            that.visualize();
        });
    }

    _build(){
        this._bindButtons();
        this.$input_area.append(this.$nbtutor_canvas);

        let that = this;
        events.on(&quot;global_hide.CellToolBar&quot;, () =&gt; {
            that.destroy();
        });

        this.toolbar.$select_view.on(&quot;change&quot;, function(){
            that.memoryUI.destroy();
            let render_view = $(this).val();
            if (render_view == &quot;none&quot;){
                that.markers.clearMarkers();
                that.markers.hideLegend();
                that.$nbtutor_canvas.addClass(&quot;nbtutor-hidden&quot;);
            } else {
                that.markers.showLegend();
                that.$nbtutor_canvas.removeClass(&quot;nbtutor-hidden&quot;);
                that.toolbar.$btn_first.trigger(&quot;click&quot;);
            }
        });

        this.codemirror.on(&quot;change&quot;, () =&gt; {
            that.markers.clearMarkers();
            that.toolbar.$select_view.val(&quot;none&quot;).trigger(&quot;change&quot;);
            that.trace_history.clear();
        });
    }

    visualize(){
        // visualize code execution
        let render_view = this.toolbar.$select_view.val();
        if (render_view == &quot;memory&quot;){
            this.memoryUI.create(this.tracestep);
        }
        if (render_view == &quot;timeline&quot;){
            this.timelineUI.create();
        }

        // Add CodeMirror line markers
        let lineNumbers = this.trace_history.getLineNumbers(this.tracestep);
        this.markers.setMarkers(lineNumbers);

        // Manage cell output
        let output_history = this.trace_history.output_history;
        this.output_area.clear_output();
        this.output_area.handle_output({
            header: {msg_type: &quot;stream&quot;},
            content: {
                name: &quot;nbtutor&quot;,
                text: output_history.getOutput(this.tracestep),
            },
        });
    }

    updateData(data){
        this.output_area.clear_output();
        this.trace_history.updateData(data)
        this.toolbar.$select_view.val(&quot;memory&quot;).trigger(&quot;change&quot;);
    }

    destroy(){
        this.$nbtutor_canvas.remove();
        this.markers.destroy();
        this.toolbar.destroy();
        this.cell.nbtutor = null;
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
