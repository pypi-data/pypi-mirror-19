# -*- coding: utf-8 -*-

'nginx 配置文件生成工具'


import argparse
from collections import OrderedDict
import os

from jinja2 import Environment, FileSystemLoader


from .release import __author__, __version__


_PRODUCT_DATA = OrderedDict([
    # 基础
    ("fs", ("10.100.100.61:80", "10.100.100.62:80", "10.100.100.63:80")),
    # base
    ("commondata", ("10.100.100.121:81", "10.100.100.122:81", "10.100.100.123:81")),
    ("user", ("10.100.100.121:82", "10.100.100.122:82", "10.100.100.123:82")),
    ("usersetting", ("10.100.100.121:83", "10.100.100.122:83", "10.100.100.123:83")),
    # 研发1
    ("shengchan", ("10.100.100.141:81", "10.100.100.142:81", "10.100.100.143:81")),
    ("caiwu", ("10.100.100.141:82", "10.100.100.142:82", "10.100.100.143:82")),
    ("licai", ("10.100.100.141:83", "10.100.100.142:83", "10.100.100.143:83")),
    ("caipiao", ("10.100.100.141:84", "10.100.100.142:84", "10.100.100.143:84")),
    ("jinxiaocun", ("10.100.100.141:85", "10.100.100.142:85", "10.100.100.143:85")),
    ("zhangben", ("10.100.100.141:86", "10.100.100.142:86", "10.100.100.143:86")),
    ("neirong", ("10.100.100.141:87", "10.100.100.142:87", "10.100.100.143:87")),
    ("daikuan", ("10.100.100.141:88", "10.100.100.142:88", "10.100.100.143:88")),
    ("huankuan", ("10.100.100.141:89", "10.100.100.142:89", "10.100.100.143:89")),
    ("jiankang", ("10.100.100.141:90", "10.100.100.142:90", "10.100.100.143:90")),
    ("meirong", ("10.100.100.141:91", "10.100.100.142:91", "10.100.100.143:91")),
    ("lvyou", ("10.100.100.141:92", "10.100.100.142:92", "10.100.100.143:92")),
    ("meishi", ("10.100.100.141:93", "10.100.100.142:93", "10.100.100.143:93")),
    ("dtrf_shenghuo", ("10.100.100.141:94", "10.100.100.142:94", "10.100.100.143:94")),
    ("xiaoshuo", ("10.100.100.141:95", "10.100.100.142:95", "10.100.100.143:95")),
    ("baoxian", ("10.100.100.141:96", "10.100.100.142:96", "10.100.100.143:96")),
    ("chongwu", ("10.100.100.141:97", "10.100.100.142:97", "10.100.100.143:97")),
    ("fangchan", ("10.100.100.141:98", "10.100.100.142:98", "10.100.100.143:98")),
    ("qiche", ("10.100.100.141:99", "10.100.100.142:99", "10.100.100.143:99")),
    ("zhifuonline", ("10.100.100.141:100", "10.100.100.142:100", "10.100.100.143:100")),
    ("cunhuo", ("10.100.100.141:101", "10.100.100.142:101", "10.100.100.143:101")),
    ("shenghuobutton", ("10.100.100.141:102",
                        "10.100.100.142:102", "10.100.100.143:102")),
    ("youxi", ("10.100.100.141:103", "10.100.100.142:103", "10.100.100.143:103")),
    ("shoucang", ("10.100.100.141:104", "10.100.100.142:104", "10.100.100.143:104")),
    ("tiwen", ("10.100.100.141:105", "10.100.100.142:105", "10.100.100.143:105")),
    ("xuexi", ("10.100.100.141:106", "10.100.100.142:106", "10.100.100.143:106")),
    ("gongyinglian", ("10.100.100.141:107",
                      "10.100.100.142:107", "10.100.100.143:107")),
    ("yanfa", ("10.100.100.141:108", "10.100.100.142:108", "10.100.100.143:108")),
    ("tuandui", ("10.100.100.141:5646", "10.100.100.142:5646", "10.100.100.143:5646")),
    # 研发2
    ("oa", ("10.100.100.161:81", "10.100.100.162:81", "10.100.100.163:81")),
    ("pm", ("10.100.100.161:82", "10.100.100.162:82", "10.100.100.163:82")),
    ("crm", ("10.100.100.161:83", "10.100.100.162:83", "10.100.100.163:83")),
    ("hr", ("10.100.100.161:84", "10.100.100.162:84", "10.100.100.163:84")),
    ("cheliang", ("10.100.100.161:85", "10.100.100.162:85", "10.100.100.163:85")),
    ("Hospital", ("10.100.100.161:86", "10.100.100.162:86", "10.100.100.163:86")),
    ("Religion", ("10.100.100.161:87", "10.100.100.162:87", "10.100.100.163:87")),
    ("School", ("10.100.100.161:88", "10.100.100.162:88", "10.100.100.163:88")),
    # 研发3
    ("imapi", ("10.100.100.181:81", "10.100.100.182:81", "10.100.100.183:81")),
    ("imh5", ("10.100.100.181:82", "10.100.100.182:82", "10.100.100.183:82")),
    ("xinwen", ("10.100.100.181:83", "10.100.100.182:83", "10.100.100.183:83")),
    # 电商
    ("shenghuocha", ("10.100.100.201:81", "10.100.100.202:81", "10.100.100.203:81")),
    ("pay", ("10.100.100.201:82", "10.100.100.202:82", "10.100.100.203:82")),
    ("chanpindianshang", ("10.100.100.201:83",
                          "10.100.100.202:83", "10.100.100.203:83")),
    ("fuwudianshang", ("10.100.100.201:84", "10.100.100.202:84", "10.100.100.203:84")),
    ("hongbao", ("10.100.100.201:85", "10.100.100.202:85", "10.100.100.203:85")),
    ("financial", ("10.100.100.201:86", "10.100.100.202:86", "10.100.100.203:86")),
    # 运营
    ("shouye", ("10.100.100.231:80", "10.100.100.232:80", "10.100.100.233:80")),
    ("yunying", ("10.100.100.231:81", "10.100.100.232:81", "10.100.100.233:81")),
    ("forum", ("10.100.100.231:82", "10.100.100.232:82", "10.100.100.233:82")),
    ("yunyingapi", ("10.100.100.231:83", "10.100.100.232:83", "10.100.100.233:83")),
    ("fenxiao", ("10.100.100.231:84", "10.100.100.232:84", "10.100.100.233:84")),
    ("fenxiaoapi", ("10.100.100.231:85", "10.100.100.232:85", "10.100.100.233:85")),
    ("settlement", ("10.100.100.231:86", "10.100.100.232:86", "10.100.100.233:86")),
])

__XIN_GANG__PRODUCT_DATA = OrderedDict([
    # 基础
    ("fs", ("192.168.16.61:80",)),
    # base
    ("commondata", ("192.168.16.121:81",)),
    ("user", ("192.168.16.121:82",)),
    ("usersetting", ("192.168.16.121:83",)),
    # 研发1
    ("shengchan", ("192.168.16.141:81",)),
    ("caiwu", ("192.168.16.141:82",)),
    ("licai", ("192.168.16.141:83",)),
    ("caipiao", ("192.168.16.141:84",)),
    ("jinxiaocun", ("192.168.16.141:85",)),
    ("zhangben", ("192.168.16.141:86",)),
    ("neirong", ("192.168.16.141:87",)),
    ("daikuan", ("192.168.16.141:88",)),
    ("huankuan", ("192.168.16.141:89",)),
    ("jiankang", ("192.168.16.141:90",)),
    ("meirong", ("192.168.16.141:91",)),
    ("lvyou", ("192.168.16.141:92",)),
    ("meishi", ("192.168.16.141:93",)),
    ("dtrf_shenghuo", ("192.168.16.141:94",)),
    ("xiaoshuo", ("192.168.16.141:95",)),
    ("baoxian", ("192.168.16.141:96",)),
    ("chongwu", ("192.168.16.141:97",)),
    ("fangchan", ("192.168.16.141:98",)),
    ("qiche", ("192.168.16.141:99",)),
    ("zhifuonline", ("192.168.16.141:100",)),
    ("cunhuo", ("192.168.16.141:101",)),
    ("shenghuobutton", ("192.168.16.141:102",)),
    ("youxi", ("192.168.16.141:103",)),
    ("shoucang", ("192.168.16.141:104",)),
    ("tiwen", ("192.168.16.141:105",)),
    ("xuexi", ("192.168.16.141:106",)),
    ("gongyinglian", ("192.168.16.141:107",)),
    ("yanfa", ("192.168.16.141:108",)),
    ("tuandui", ("192.168.16.141:5646",)),
    # 研发2
    ("oa", ("192.168.16.161:81",)),
    ("pm", ("192.168.16.161:82",)),
    ("crm", ("192.168.16.161:83",)),
    ("hr", ("192.168.16.161:84",)),
    ("cheliang", ("192.168.16.161:85",)),
    ("Hospital", ("192.168.16.161:86",)),
    ("Religion", ("192.168.16.161:87",)),
    ("School", ("192.168.16.161:88",)),
    # 研发3
    ("imapi", ("192.168.16.181:81",)),
    ("imh5", ("192.168.16.181:82",)),
    ("xinwen", ("192.168.16.181:83",)),
    # 电商
    ("shenghuocha", ("192.168.16.201:81",)),
    ("pay", ("192.168.16.201:82",)),
    ("chanpindianshang", ("192.168.16.201:83",)),
    ("fuwudianshang", ("192.168.16.201:84",)),
    ("hongbao", ("192.168.16.201:85",)),
    ("financial", ("192.168.16.201:86",)),
    # 运营
    ("shouye", ("192.168.16.231:80",)),
    ("yunying", ("192.168.16.231:81",)),
    ("forum", ("192.168.16.231:82",)),
    ("yunyingapi", ("192.168.16.231:83",)),
    ("fenxiao", ("192.168.16.231:84",)),
    ("fenxiaoapi", ("192.168.16.231:85",)),
    ("settlement", ("192.168.16.231:86",)),
])


def format_sub_dir(name):
    return '/' if name == 'shouye' else '/{0}/'.format(name)


def main():
    parser = argparse.ArgumentParser(description=__doc__)
    parser.add_argument('-o', '--outfile',
                        default='nginx.conf', help='保存为指定的文件')
    parser.add_argument(
        '-t', '--type', choices=['prod', 'xingang'], default='prod', help='类型；prod：托管环境；xingang：新港')
    parser.add_argument('-v', '--version', action='version',
                        version='%(prog)s {0}' .format(__version__))
    args = parser.parse_args()
    env = Environment(loader=FileSystemLoader(
        os.path.join(os.path.split(__file__)[0], 'templates')))
    env.filters['format_sub_dir'] = format_sub_dir
    tmp = env.get_template('template.j2')
    txt = tmp.render(data=_PRODUCT_DATA if args.type ==
                     'prod' else __XIN_GANG__PRODUCT_DATA)
    with open(args.outfile, 'w') as f:
        f.write(txt)

    print('completed!you select %s type,nginx conf saved to %s file.' % (
        args.type, args.outfile))

if __name__ == '__main__':
    main()
