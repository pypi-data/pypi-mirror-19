<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How It Works &#8212; PyBufrKit 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-it-works">
<h1>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bufr-message-configuration-files">
<h2>BUFR Message Configuration files<a class="headerlink" href="#bufr-message-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>The configurations describe how a BUFR message is composed of sections and how each
section is organised. They are used to provide the overall structure definition
of a BUFR message. The purpose of using configurations is to allow greater
flexibility so that changes of BUFR Spec do NOT (to a certain extent) require
program changes.</p>
<p>The builtin Configuration JSON files are located in the
<a class="reference external" href="https://github.com/ywangd/pybufrkit/tree/master/pybufrkit/definitions">definitions</a>
directory inside the package. It can also be configured to load from an user
provided directory. The naming convention of the files is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sectionX</span><span class="p">[</span><span class="o">-</span><span class="n">Y</span><span class="p">]</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>where X is the section index, Y is the edition number and optional.</p>
<p>Each section is configured with some metadata and a list of parameters.
It takes the following general format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># zero-based section index</span>

  <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Indicator section&quot;</span><span class="p">,</span>

  <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>  <span class="c1"># use this config if an edition-specific one is not available</span>

  <span class="s2">&quot;optional&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="c1"># whether this section is optional</span>

  <span class="s2">&quot;end_of_message&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="c1"># whether this is the last section</span>

  <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># a list of parameter configs</span>
    <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;start_signature&quot;</span><span class="p">,</span>  <span class="c1"># parameter name</span>

      <span class="s2">&quot;nbits&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>  <span class="c1"># number of bits</span>

      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span>  <span class="c1"># parameter type determines how the value can be processed from the input bits</span>

      <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="s2">&quot;BUFR&quot;</span><span class="p">,</span>  <span class="c1"># expected value for this parameter (will be validated if not None)</span>

      <span class="s2">&quot;as_property&quot;</span><span class="p">:</span> <span class="n">false</span>  <span class="c1"># whether this parameter can be accessed from the parent message object</span>
    <span class="p">},</span>
    <span class="o">...</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A few more notes about the configuration:</p>
<ul class="simple">
<li>Some section, e.g. Section 1, has edition-specific configuration, e.g. <code class="docutils literal"><span class="pre">section1-1.json</span></code>.
However, most sections have a single configuration for all editions. The <code class="docutils literal"><span class="pre">default</span></code> field
is used to indicate that the configuration is a catch-all for any editions that does not
have its own specific config.</li>
<li>Number of bits can be set to <code class="docutils literal"><span class="pre">0</span></code>, which means value of the corresponding parameter takes
all the bits left for the section.</li>
<li><dl class="first docutils">
<dt>There are generally two categories of parameter types, simple and complex.</dt>
<dd><ul class="first last">
<li>Simple types are <code class="docutils literal"><span class="pre">uint</span></code> (unsigned integer), <code class="docutils literal"><span class="pre">int</span></code> (signed integer), <code class="docutils literal"><span class="pre">bool</span></code>,
<code class="docutils literal"><span class="pre">bin</span></code> (binary bits) and <code class="docutils literal"><span class="pre">bytes</span></code> (string).</li>
<li>Complex types include <code class="docutils literal"><span class="pre">unexpanded_descriptors</span></code> and <code class="docutils literal"><span class="pre">template_data</span></code>. How they are
processed is taken care of by a processor, e.g. Decoder. The configuration file does
not concern how they are interpreted.</li>
</ul>
</dd>
</dl>
</li>
<li>The <code class="docutils literal"><span class="pre">expected</span></code> value will be validated against the actual value processed from the input.
Currently, it is only used to ensure the start and stop signatures of a BUFR message.</li>
<li>To allow loose coupling between sections, the parent message object can be configured to
proxy some fields from a section. This is what the <code class="docutils literal"><span class="pre">as_property</span></code> field is
for. For an example, the <code class="docutils literal"><span class="pre">edition</span></code> field from section 0 is needed for other
sections to determine their structures. Therefore the <code class="docutils literal"><span class="pre">edition</span></code> field is
proxyed by the parent message object so that it can be accessed by other
sections without worrying about exactly which section provides this
information.</li>
</ul>
</div>
<div class="section" id="decoder-and-encoder">
<h2>Decoder and Encoder<a class="headerlink" href="#decoder-and-encoder" title="Permalink to this headline">¶</a></h2>
<p>These components process the input as prescribed by the configurations.
Each sections are processed in order of the section index. The components
also provide specialised methods to process parameters of complex types.
The processing of <code class="docutils literal"><span class="pre">template_data</span></code> is where most of the program logic goes.</p>
<p>The <code class="docutils literal"><span class="pre">Decoder</span></code> and <code class="docutils literal"><span class="pre">Encoder</span></code> are sub-classes of the same abstract <code class="docutils literal"><span class="pre">Coder</span></code> class.
They are implemented using the
<a class="reference external" href="https://en.wikipedia.org/wiki/Template_method_pattern">Template Method Pattern</a>.
The <code class="docutils literal"><span class="pre">Coder</span></code> base class provides bootstrapping and common functions needed by all
of the sub-classes and leaves spaces for sub-classes to fill in the actual
processing of the parameters.</p>
<p>For an example, the base class knows how to process an Element Descriptor.
It prepares all necessary information about the descriptor, including its
type, number of bits, units, scale, reference, etc. Depending on its type,
the base class then invoke a method provided by the subclass to handle the
actual processing, which can be either decoding or encoding.</p>
</div>
<div class="section" id="bufr-template-compilation">
<h2>BUFR Template Compilation<a class="headerlink" href="#bufr-template-compilation" title="Permalink to this headline">¶</a></h2>
<p>The main purpose of Template Compilation is performance. However since bit
operations are the most time consuming part in the overall processing. The
performance gain somewhat is limited. Depending on the total number of
descriptors to be processed for a message, template compilation provides 10 -
30% performance boost. Larger number of descriptors, i.e. longer message,
generally lead to less performance gain.</p>
<p>The implementation of <code class="docutils literal"><span class="pre">TemplateCompiler</span></code> is similar to the Decoder/Encoder.
It is also a subclass of the abstract <code class="docutils literal"><span class="pre">Coder</span></code> class. It uses introspection
to record method calls dispatched by the base class. The recorded calls
can then be executed more efficiently because they bypass most of the
BUFR template processing, such as checking descriptor type, expand sequence
descriptors, etc.</p>
</div>
<div class="section" id="template-data-wiring">
<h2>Template Data Wiring<a class="headerlink" href="#template-data-wiring" title="Permalink to this headline">¶</a></h2>
<p>A BUFR Template is by nature hierarchical. For an example, a sequence descriptor
has all of its child descriptors nested under it. When data associated to the
template is decoded, they can also be organised in a hierarchical format. This
is especially necessary when some operator descriptors, such as 204YYY
(associated field) and bitmap related operators (222, 223, 224, 225, 232, 235,
236, 237), make some values as attributes to other values. The wiring process
associates attributes to their owners so that their meanings are explicit.</p>
</div>
<div class="section" id="renderer">
<h2>Renderer<a class="headerlink" href="#renderer" title="Permalink to this headline">¶</a></h2>
<p>This component is responsible for rendering the processed BUFR message object
in different formats, e.g. plain text, JSON.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How It Works</a><ul>
<li><a class="reference internal" href="#bufr-message-configuration-files">BUFR Message Configuration files</a></li>
<li><a class="reference internal" href="#decoder-and-encoder">Decoder and Encoder</a></li>
<li><a class="reference internal" href="#bufr-template-compilation">BUFR Template Compilation</a></li>
<li><a class="reference internal" href="#template-data-wiring">Template Data Wiring</a></li>
<li><a class="reference internal" href="#renderer">Renderer</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/internals.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Yang Wang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/internals.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>