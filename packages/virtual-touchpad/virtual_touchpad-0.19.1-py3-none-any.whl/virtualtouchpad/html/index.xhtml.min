<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html><html manifest="virtual-touchpad.appcache" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="yes" name="mobile-web-app-capable"/><meta content="width=device-width,user-scalable=no" name="viewport"/><link href="/img/icon196x196.png" rel="shortcut icon" sizes="196x196"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><link href="/img/icon144x144.png" rel="apple-touch-icon" sizes="144x144"/><link href="/img/icon114x114.png" rel="apple-touch-icon" sizes="114x114"/><link href="/img/icon72x72.png" rel="apple-touch-icon" sizes="72x72"/><link href="/img/icon57x57.png" rel="apple-touch-icon" sizes="57x57"/><title x-tpl="">Virtual Touchpad ${application.version}</title><style href="/css/app.css" type="text/css"><![CDATA[html,body{background-color:black;height:100%;margin:0}table.stack caption{font-size:12pt;margin-top:5pt;text-align:left}table.stack td{font-family:courier;font-size:10pt}table.stack td:nth-child(2){padding-right:50pt}#keyboard{position:absolute;left:0;right:0;bottom:0;overflow:hidden;max-height:0}@media screen and (min-width:448px){#keyboard{transition:max-height 1s ease}.connected #keyboard.ready{max-height:100%}.message-box #keyboard.ready{max-height:0}}#keyboard-func{position:absolute;left:0;right:0;top:0;margin-top:-100%;overflow:hidden}@media screen and (min-width:448px) and (max-aspect-ratio:448 / 206){#keyboard-func{transition:margin-top 1s ease}*:full-screen .connected #keyboard-func.ready{margin-top:0}*:-moz-full-screen .connected #keyboard-func.ready{margin-top:0}*:-webkit-full-screen .connected #keyboard-func.ready{margin-top:0}.message-box #keyboard-func.ready{margin-top:-100%}}@media screen and (min-width:448px) and (max-aspect-ratio:448 / 244){#keyboard-func{transition:margin-top 1s ease}.connected #keyboard-func.ready{margin-top:52px}.message-box #keyboard-func.ready{margin-top:;-100%}}#settings-overlay{display:none}.connected #settings-overlay.toggled{display:block;position:absolute;z-index:50;min-height:100%;top:0;left:0;right:0}#settings-view{position:absolute;z-index:51;top:48px;left:0;bottom:0;width:67%;margin-left:-67%;transition:margin-left .3s cubic-bezier(0,1,0.9,1);background:linear-gradient(white 0,#E0E0E0 50%,#D0D0D0 100%);background-color:white}.connected #settings-view.toggled{margin-left:0}#settings-view.sliding{transition:none}#settings-view>div{color:black;font-family:sans-serif;font-size:18pt;margin:32px}#toolbar{z-index:50;position:fixed;display:table-cell;left:0;right:0;top:0;margin:0;padding:4px;vertical-align:middle;text-align:right;background-color:white;transition:margin-top 1s ease}@media(orientation:landscape){*:fullscreen #toolbar{margin-top:-52px}*:-moz-full-screen #toolbar{margin-top:-52px}*:-webkit-full-screen #toolbar{margin-top:-52px}}#toolbar>x-button{display:table-cell;height:44px;width:44px;border:0;margin-left:4px;margin-right:4px;padding:0;outline:0;vertical-align:middle;text-align:center;background-color:transparent;opacity:.3;pointer-events:none}.connected #toolbar>x-button{opacity:1.0;pointer-events:all}#toolbar>x-button.settings{float:left}#toolbar>x-button.help{float:right}#toolbar>x-button.fullscreen{float:right}#toolbar>x-button svg{fill:#606060;stroke:#606060;stroke-linecap:round;stroke-linejoin:round;stroke-width:4}#toolbar>x-button text{font-family:sans;font-size:32px;font-weight:bolder;stroke:none}#toolbar>x-button .frame{fill:none}#toolbar>x-button .shape{stroke:none}*:fullscreen #toolbar>x-button.fullscreen{display:none}*:-moz-full-screen #toolbar>x-button.fullscreen{display:none}*:-webkit-full-screen #toolbar>x-button.fullscreen{display:none}.fullscreen-disabled #toolbar>x-button.fullscreen{display:none}x-keyboard svg{width:100%}circle.keyboard,line.keyboard,path.keyboard,rect.keyboard{stroke-width:2;stroke-linecap:round;stroke-linejoin:round}path.keyboard.shift{fill:none}text.keyboard,keyboard text{font-family:arial;font-size:16px}text.keyboard.small,keyboard text.small{font-size:10px}.keyboard.background{fill:#e0e0e0}.keyboard.background.special{fill:#a0a0e0}.keyboard.background.layout{fill:#a0e0a0}.keyboard.overlay{fill:url(#keyboard-shade);fill-opacity:.2;stroke:#c0c0c0}.keyboard.overlay.special{stroke:#a0a0c0}.keyboard.overlay.layout{stroke:#a0c0a0}.keyboard.drawing{stroke:black}x-keyboard .key text{visibility:hidden}x-keyboard .key text.static{visibility:visible;font-size:9px}x-keyboard.mod-none .key text.mod-none{visibility:visible}x-keyboard.mod-shift .key text.mod-shift{visibility:visible}x-keyboard.mod-altgr .key text.mod-altgr{visibility:visible}x-keyboard.mod-both .key text.mod-both{visibility:visible}x-keyboard .key{transform-origin:50% 50%;transform:scale(1.0);transition:transform .05s ease}x-keyboard .key.pressed{transform:scale(0.85)}x-message-box{z-index:100;position:fixed;left:0;right:0;max-height:0;transition:max-height 1s ease;margin:4pt;margin-top:60px;padding:0;background-color:white;color:black;font-family:sans-serif;font-size:18pt}.message-box x-message-box{max-height:100%;padding:4pt}x-message-box.error{}x-trackbar{display:block;height:48px;width:100%;background:none}x-trackbar .track{display:block;position:relative;width:100%;height:4px;left:0;top:0;margin-top:16px;background-color:#A0A0A0}x-trackbar .groove{display:block;position:relative;height:4px;margin-right:10px;background-color:#00F}x-trackbar .mark{position:relative;top:-10px;float:right;margin-right:-10px;width:16px;height:16px;background-color:white;transition:background-color .2s ease;border:4px solid #00F;border-radius:16px}x-trackbar.active .mark{background-color:#00F}x-touchpad{display:block;position:absolute;top:0;left:0;right:0;min-height:100%;background:radial-gradient(circle at bottom center,#282828 0,#181818 50%,black 100%)}]]></style><script type="text/javascript"><![CDATA[exports=window;exports.util=(function(){var a={};a.cloneTouches=function(a){if(!a)return [];var b=[];for(var c=0;c<a.length;c++)b.push({identifier:a[c].identifier,screenX:a[c].screenX,screenY:a[c].screenY,clientX:a[c].clientX,clientY:a[c].clientY});return b;};a.mapSupplier=function(a){function b(b){return a[b];}return b;};String.prototype.xmlEscape=function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&apos;');};String.prototype.format=function(a){return this.replace(/\$\{([^}]*)\}/g,function(b,c){var d=a(c);return d?d:"";});};Element.prototype.position=function(){var a=0;var b=0;var c=this;while(true){a+=c.offsetLeft;b+=c.offsetTop;if(c.offsetParent===null)break;c=c.offsetParent;}return [a,b];};Element.prototype.handleEvent=function(a){var b=this.getAttribute("on"+a);if(b)this.addEventListener(a,function(a){eval(b);});};return a;})();exports.template=(function(){var a={TEMPLATE_ATTR:"x-tpl",ORIGINAL_ATTR:"x-tpl-original"};function b(){var b=d();for(i=0;i<b.length;i++){var c=b[i];c.setAttribute(a.ORIGINAL_ATTR,c.innerHTML);c.innerHTML=c.innerHTML.format(util.mapSupplier(server.status));}};function c(){var b=d();for(i=0;i<b.length;i++){var c=b[i];var e=c.getAttribute(a.ORIGINAL_ATTR)||c.innerHTML;c.innerHTML=e.format(util.mapSupplier(server.status));}};function d(){var b=document.evaluate("//*[@"+a.TEMPLATE_ATTR+"]",document,null,XPathResult.ANY_TYPE,null);var c;var d=[];while(c=b.iterateNext()){c.normalize();d.push(c);}return d;}function e(){e.remaining--;if(e.remaining==0)b();}e.remaining=0;document.addEventListener("statusload",e);document.addEventListener("statusupdate",c);e.remaining++;document.addEventListener("translated",e);e.remaining++;addEventListener("load",function(){if(!exports.translation)e();});return a;})();exports.checks=(function(){var a={FULLSCREEN_DISABLED_CLASS:"fullscreen-disabled",failures:[]};a.failed=function(b){return a.failures.indexOf(b)!=-1;};if(typeof WebSocket=="undefined")a.failures.push("WebSocket");if(!("ontouchstart" in window))a.failures.push("TouchEvents");else if(typeof (TouchList.prototype.identifiedTouch)==="undefined")TouchList.prototype.identifiedTouch=function(a){for(var b=0;b<this.length;b++)if(this[b].identifier===a)return this[b];};if(!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")&&!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"))a.failures.push("SVG");if(typeof (document.documentElement.requestFullscreen)==="undefined")if(document.documentElement.mozRequestFullScreen){document.documentElement.requestFullscreen=document.documentElement.mozRequestFullScreen;document.exitFullscreen=document.mozCancelFullScreen;}else if(document.documentElement.webkitRequestFullscreen){document.documentElement.requestFullscreen=function(){return document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);};document.exitFullscreen=document.webkitExitFullscreen;}else{document.documentElement.requestFullscreen=function(){};document.exitFullscreen=function(){};document.documentElement.classList.add(a.FULLSCREEN_DISABLED_CLASS);}if(typeof "Storage"=="undefined")a.failures.push("WebStorage");return a;})();exports.configuration=(function(){var a={_storage:{},get:function(a,c){var d=b(a);switch(typeof c){case "boolean":if(d==="true")return true;else if(d==="false")return false;break;case "number":if(!isNaN(parseFloat(d)))return parseFloat(d);break;case "string":if(d)return d.toString();break;}return c;},set:function(a,b){c(a,b);}};var b=checks.failed("WebStorage")?function(b){return a._storage[b];}:function(a){return localStorage[a];};var c=checks.failed("WebStorage")?function(b,c,d){a._storage[b]=c.toString();}:function(a,b){localStorage[a]=b;};return a;})();exports.controller=(function(){var a={};function b(a){this.ws=a;};a.Touchpad=b;b.prototype.buttonDown=function(a){this.ws.send(JSON.stringify({command:"mouse.down",data:{button:a}}));};b.prototype.buttonUp=function(a){this.ws.send(JSON.stringify({command:"mouse.up",data:{button:a}}));};b.prototype.scroll=function(a,b){this.ws.send(JSON.stringify({command:"mouse.scroll",data:{dx:a,dy:b}}));};b.prototype.move=function(a,b){this.ws.send(JSON.stringify({command:"mouse.move",data:{dx:a,dy:b}}));};function c(a){this.ws=a;};a.Keyboard=c;c.prototype.press=function(a,b){this.ws.send(JSON.stringify({command:"key.down",data:{name:a,is_dead:b}}));};c.prototype.release=function(a,b){this.ws.send(JSON.stringify({command:"key.up",data:{name:a,is_dead:b}}));};return a;})();exports.features=(function(){var a={};a.listMissing=function(){var a=document.createDocumentFragment();function b(b){var c=document.createElement("li");c.innerHTML=b;a.appendChild(c);}if(checks.failed("WebSocket"))b(_("WebSockets are not supported"));if(checks.failed("TouchEvents"))b(_("Touch events are not supported"));if(checks.failed("SVG"))b(_("SVG images are not supported"));if(a.childNodes.length>0){var c=document.createDocumentFragment();c.appendChild(document.createTextNode(_("Your browser does not support Virtual Touchpad. These "+"features are missing:")));var d=document.createElement("ul");d.appendChild(a);c.appendChild(d);c.appendChild(document.createTextNode(_("Please upgrade your browser to a newer version.")));messagebox.show(c,["error"]);return true;}else return false;};return a;})();exports.include=(function(){var a={EL:"x-include"};function b(a,b){this.parentEl=a;this.href=b;this.reload();};a.Include=b;b.prototype.reload=function(){var a=new XMLHttpRequest();a.open("GET",this.href,true);a.send();a.onload=(function(b){if(a.responseCode<200||a.responseCode>=300)return;var c=new DOMParser();var d=c.parseFromString(a.responseText,"text/xml");var e=this.parentEl;var f=d.documentElement;this.parentEl=f;f.include=this;f.setAttribute("id",e.getAttribute("id"));e.parentNode.insertBefore(f,e);e.parentNode.removeChild(e);}).bind(this);};addEventListener("load",function(){var c=document.querySelectorAll(a.EL);for(var d=0;d<c.length;d++){var e=c[d];var f=e.getAttribute("href");var g=new b(e,f);e.include=g;}});return a;})();exports.keyboard=(function(){var a={EL:"x-keyboard",KEYS_ROOT_CLASS:"keys",KEY_CLASS:"key",NAME_ATTR:"x-name",ID_ATTR:"x-id",ACTION_ATTR:"x-action",getModifier:function(b,c){return b.classList.contains(c)||b.classList.contains(a.MOD_CLASSES.BOTH);},setModifier:function(b,c,d){var e;switch(c){case a.MOD_CLASSES.SHIFT:e=a.MOD_CLASSES.ALTGR;break;case a.MOD_CLASSES.ALTGR:e=a.MOD_CLASSES.SHIFT;break;default:return;}if(d){if(a.getModifier(b,e)){b.classList.remove(e);b.classList.add(a.MOD_CLASSES.BOTH);}else b.classList.add(c);b.classList.remove(a.MOD_CLASSES.NONE);}else if(b.classList.contains(a.MOD_CLASSES.BOTH)){b.classList.remove(a.MOD_CLASSES.BOTH);b.classList.add(e);}else{b.classList.remove(c);b.classList.add(a.MOD_CLASSES.NONE);}},MOD_CLASSES:{NONE:"mod-none",BOTH:"mod-both",SHIFT:"mod-shift",ALTGR:"mod-altgr"},READY_CLASS:"ready"};function b(b,c,d){this.parentEl=b;this.doc=null;this._touches={};b.classList.add(a.MOD_CLASSES.NONE);Object.defineProperty(this,"shift",{get:function(){return a.getModifier(b,a.MOD_CLASSES.SHIFT);},set:function(c){a.setModifier(b,a.MOD_CLASSES.SHIFT,c);}});Object.defineProperty(this,"altgr",{get:function(){return a.getModifier(b,a.MOD_CLASSES.ALTGR);},set:function(c){a.setModifier(b,a.MOD_CLASSES.ALTGR,c);}});this._layout=d;Object.defineProperty(this,"layout",{get:function(){return this._layout;},set:function(c){this._layout=c;b.classList.remove(a.READY_CLASS);var d=new XMLHttpRequest();d.open("GET",c,true);d.send();d.onload=(function(c){try{if(this._applyLayout(JSON.parse(d.responseText)))b.classList.add(a.READY_CLASS);else{}}catch(c){}}).bind(this);}});Object.defineProperty(this,"layoutName",{get:function(){return this._layoutData?this._layoutData.meta.name:"";}});var e=new XMLHttpRequest();e.open("GET",c,true);e.send();e.onload=(function(c){var f=new DOMParser();var g=f.parseFromString(e.responseText,"text/xml");b.appendChild(g.documentElement);this.svg=b.querySelector("svg");this.keys=this.svg.querySelector("."+a.KEYS_ROOT_CLASS);this.keys.addEventListener("touchstart",this.onTouchStart.bind(this));this.keys.addEventListener("touchmove",this.onTouchMove.bind(this));this.keys.addEventListener("touchend",this.onTouchEnd.bind(this));if(d)this.layout=d;else b.classList.add(a.READY_CLASS);}).bind(this);};a.Keyboard=b;b.prototype._isKey=function c(b){return b.classList&&b.classList.contains(a.KEY_CLASS);};b.prototype._getKey=function d(b){return this.svg.querySelector("."+a.KEY_CLASS+"["+a.ID_ATTR+"='"+b+"']");};b.prototype._eachKey=function e(a,b){for(var c=0;c<a.length;c++){var d=a[c];var e=document.elementFromPoint(d.pageX,d.pageY);while(e){if(this._isKey(e))break;e=e.parentNode;}b(e,d.identifier);}};b.prototype._addTexts=function f(b,c){for(var d=0;d<c.length;d++){var e=c[d][0];if(!e)continue;var f=(d&1)!=0;var g=(d&2)!=0;var h=parseInt(b.firstChild.getAttribute("x"));var i=parseInt(b.firstChild.getAttribute("y"));var j=b.getBBox();var k=document.createElementNS("http://www.w3.org/2000/svg","text");k.appendChild(document.createTextNode(e));if(f&&g)k.classList.add(a.MOD_CLASSES.BOTH);else if(f)k.classList.add(a.MOD_CLASSES.SHIFT);else if(g)k.classList.add(a.MOD_CLASSES.ALTGR);else k.classList.add(a.MOD_CLASSES.NONE);k.setAttribute("text-anchor","middle");k.setAttribute("alignment-baseline","middle");k.setAttribute("x",h+j.width/2);k.setAttribute("y",i+j.height/2);b.appendChild(k);}};b.prototype._applyLayout=function g(a){for(var b in a.layout){if(!a.layout.hasOwnProperty(b))continue;var c=a.layout[b];var d=this._getKey(b);if(!d)return false;while(d.childNodes.length>1)d.removeChild(d.childNodes[1]);this._addTexts(d,c);}this._layoutData=a;return true;};b.prototype.onTouchStart=function h(a){this._eachKey(a.touches,(function(a,b){this._touches[b]=a;if(a)this._press(a);}).bind(this));a.preventDefault();};b.prototype.onTouchMove=function i(a){this._eachKey(a.touches,(function(a,b){var c=this._touches[b];if(c&&c!==a)this._release(c);if(a&&a!==c){this._touches[b]=a;this._press(a);}}).bind(this));a.preventDefault();};b.prototype.onTouchEnd=function j(a){this._eachKey(a.changedTouches,(function(a,b){var c=this._touches[b];this._release(c);delete this._touches[b];}).bind(this));a.preventDefault();};b.prototype._handleKey=function k(b,c){if(c)b.classList.add("pressed");else b.classList.remove("pressed");var d=b.getAttribute(a.ACTION_ATTR);var e=b.getAttribute(a.NAME_ATTR);if(e)e="<"+e+">";var f=false;var g=b.getAttribute(a.ID_ATTR);if(!e&&g){var b=this._layoutData.layout[g];var h=(this.shift<<0)|(this.altgr<<1);e=b[h][0];f=b[h][1];}switch(e){case "<alt_gr>":this.altgr=c;break;case "<caps_lock>":if(c)this.shift=!this.shift;break;case "<shift_l>":case "<shift_r>":this.shift=c;break;}if(e)this.parentEl.dispatchEvent(new CustomEvent(c?"press":"release",{"detail":[e,f]}));if(d&&c){this.parentEl.dispatchEvent(new CustomEvent("action",{"detail":[d]}));b.classList.remove("pressed");}};b.prototype._press=function l(a){if(navigator.vibrate)navigator.vibrate(20);this._handleKey(a,true);};b.prototype._release=function m(a){this._handleKey(a,false);};addEventListener("load",function(){var c=document.querySelectorAll(a.EL);for(var d=0;d<c.length;d++){var e=c[d];var f=e.getAttribute("src");var g=e.getAttribute("layout");e.keyboard=new b(e,f,g);e.handleEvent("press");e.handleEvent("release");e.handleEvent("action");}});return a;})();exports.messagebox=(function(){var a={ID:"message-box",MESSAGE_BOX_CLASS:"message-box"};a.show=function(b,c){var d=document.getElementById(a.ID);while(d.firstChild)d.removeChild(d.firstChild);if(typeof b==="string")d.innerHTML=b;else d.appendChild(b);d.className=c.join(", ");document.documentElement.classList.add(a.MESSAGE_BOX_CLASS);};return a;})();exports.server=(function(){var a={status:{}};var b=new XMLHttpRequest();b.open("GET","/status",true);b.send();b.onload=function(c){var d=JSON.parse(b.responseText);a.status=d;document.dispatchEvent(new CustomEvent("statusload",{detail:d}));};var c=new WebSocket("ws://${host}/status/updates".format(util.mapSupplier(window.location)));c.onmessage=function(b){var c=JSON.parse(b.data);a.status[c.item]=c.value;document.dispatchEvent(new CustomEvent("statusupdate",{detail:c}));};return a;})();exports.view=(function(){var a={EL:"x-touchpad",CLICK_THRESHOLD:10};function b(a){this.parentEl=a;var b=this;this.parentEl.addEventListener("touchstart",function(){return b.onTouchStart.apply(b,arguments);});this.parentEl.addEventListener("touchend",function(){return b.onTouchEnd.apply(b,arguments);});this.parentEl.addEventListener("touchcancel",function(){return b.onTouchCancel.apply(b,arguments);});this.parentEl.addEventListener("touchleave",function(){return b.onTouchEnd.apply(b,arguments);});this.parentEl.addEventListener("touchmove",function(){return b.onTouchMove.apply(b,arguments);});};a.Touchview=b;b.prototype._calculateMovement=function(a,b){var c=b.screenX-a.screenX;var d=b.screenY-a.screenY;var e=Math.sqrt(c*c+d*d);var f=Math.atan2(d,c);var g=configuration.get("view.acceleration",0.3);var h=configuration.get("view.sensitivity",1.5);var i=h*Math.pow(e,1.0+g);return [Math.cos(f)*i,Math.sin(f)*i];};b.prototype._calculateScroll=function(a,b){var c=b.screenX-a.screenX;var d=b.screenY-a.screenY;var e=configuration.get("view.naturalScroll",true)?-1:1;var f=configuration.get("view.naturalScroll",true)?-1:1;return [c*e,d*f];};b.prototype.click=function(a){if(this.clickInProgress())return;var b=util.cloneTouches(this.currentTouches);this._click=setTimeout((function(){var a=b.length==2?"right":"left";this.parentEl.dispatchEvent(new CustomEvent("buttondown",{"detail":[a]}));this.parentEl.dispatchEvent(new CustomEvent("buttonup",{"detail":[a]}));delete this._click;}).bind(this),300);};b.prototype.clickInProgress=function(){return !!this._click;};b.prototype.clickCancel=function(){if(this._click){clearTimeout(this._click);this._click=undefined;return true;}else return false;};b.prototype.dndStart=function(){this._dnd=true;this.parentEl.dispatchEvent(new CustomEvent("buttondown",{"detail":["left"]}));};b.prototype.dndInProgress=function(){return !!this._dnd;};b.prototype.dndEnd=function(){this._dnd=false;this.parentEl.dispatchEvent(new CustomEvent("buttonup",{"detail":["left"]}));};b.prototype.onTouchStart=function(a){this.currentTouches=util.cloneTouches(a.touches);this._accumulatedMovement=0;a.preventDefault();};b.prototype.onTouchEnd=function(b){if(this._accumulatedMovement<a.CLICK_THRESHOLD)if(this.dndInProgress())this.dndEnd();else this.click(this.currentTouches.length==2?"right":"left");delete this.currentTouches;};b.prototype.onTouchCancel=function(a){};b.prototype.onTouchLeave=function(a){};b.prototype.onTouchMove=function(a){if(this.clickInProgress()){this.clickCancel();this.dndStart();}if(!a.changedTouches)return;if(a.changedTouches.length!=this.currentTouches.length)return;var b=this.currentTouches[0];var c=a.changedTouches.identifiedTouch(b.identifier);this._accumulatedMovement+=Math.sqrt(0+Math.pow(c.screenX-b.screenX,2)+Math.pow(c.screenY-b.screenY,2));this.currentTouches=util.cloneTouches(a.changedTouches);if(a.changedTouches.length==1){var d=this._calculateMovement(b,c);this.parentEl.dispatchEvent(new CustomEvent("move",{"detail":d}));}else if(a.changedTouches.length==2){var e=this._calculateScroll(b,c);this.parentEl.dispatchEvent(new CustomEvent("scroll",{"detail":e}));}a.preventDefault();};addEventListener("load",function(){var c=document.querySelectorAll(a.EL);for(var d=0;d<c.length;d++){var e=c[d];e.touchview=new b(e);e.handleEvent("buttondown");e.handleEvent("buttonup");e.handleEvent("move");e.handleEvent("scroll");}});return a;})();exports.trackbar=(function(){var a={EL:"x-trackbar",VALUE_ATTR:"value",MIN_VALUE_ATTR:"min-value",MAX_VALUE_ATTR:"max-value",PROPERTY_ATTR:"property",DEFAULT_VALUE_ATTR:"default-value",ACTIVE_CLASS:"active",TRACK_CLASS:"track",GROOVE_CLASS:"groove",MARK_CLASS:"mark"};function b(b,c,d,e){this.parentEl=b;this._value=c<d?d:c>e?e:c;this.minValue=d;this.maxValue=e;this.trackEl=document.createElement("div");this.trackEl.classList.add(a.TRACK_CLASS);this.parentEl.appendChild(this.trackEl);this.grooveEl=document.createElement("div");this.grooveEl.classList.add(a.GROOVE_CLASS);this.trackEl.appendChild(this.grooveEl);this.markEl=document.createElement("div");this.markEl.classList.add(a.MARK_CLASS);this.grooveEl.appendChild(this.markEl);this.parentEl.addEventListener("touchstart",this.onTouchStart.bind(this));this.parentEl.addEventListener("touchend",this.onTouchEnd.bind(this));this.parentEl.addEventListener("touchcancel",this.onTouchCancel.bind(this));this.parentEl.addEventListener("touchleave",this.onTouchEnd.bind(this));this.parentEl.addEventListener("touchmove",this.onTouchMove.bind(this));};a.Trackbar=b;b.prototype._refresh=function(){var a=(this._value-this.minValue)/(this.maxValue-this.minValue);this.grooveEl.style.width=(a*100).toFixed(0)+"%";};b.prototype._xToValue=function(a){var b=this.maxValue-this.minValue;return this.minValue+(a-this.parentEl.position()[0]-this.markEl.clientWidth/2)*b/(this.parentEl.clientWidth-this.markEl.clientWidth);};b.prototype.value=function(){return this._value;};b.prototype.setValue=function(a){this._value=a<this.minValue?this.minValue:a>this.maxValue?this.maxValue:a;this._refresh();this.parentEl.dispatchEvent(new CustomEvent("valuechanged",{value:this._value}));};b.prototype.onTouchStart=function(b){if(b.touches.length>1)return;this.parentEl.classList.add(a.ACTIVE_CLASS);this._currentTouch=util.cloneTouches(b.touches)[0];this.setValue(this._xToValue(this._currentTouch.pageX));b.preventDefault();};b.prototype.onTouchEnd=function(b){this.parentEl.classList.remove(a.ACTIVE_CLASS);this._currentTouch=undefined;b.preventDefault();};b.prototype.onTouchCancel=function(a){};b.prototype.onTouchLeave=function(a){};b.prototype.onTouchMove=function(a){if(!this._currentTouch||!a.changedTouches)return;var b=a.changedTouches.identifiedTouch(this._currentTouch.identifier);if(!b)return;var c=b.pageX;this.setValue(this._xToValue(c));a.preventDefault();};a.find=function(a){var b=document.querySelectorAll(a);var c=[];for(var d=0;d<b.length;d++){var e=b[d];if(e.trackbar)c.push(e.trackbar);}return c;};addEventListener("load",function(){var c=document.querySelectorAll(a.EL);for(var d=0;d<c.length;d++){var e=c[d];var f=eval(e.getAttribute(a.VALUE_ATTR));if(isNaN(f))f=0.0;var g=eval(e.getAttribute(a.MIN_VALUE_ATTR));if(isNaN(g))g=0.0;var h=eval(e.getAttribute(a.MAX_VALUE_ATTR));if(isNaN(h))h=g+1.0;e.trackbar=new b(e,f,g,h);e.handleEvent("valuechanged");var i=e.getAttribute(a.PROPERTY_ATTR);if(i){e.addEventListener("valuechanged",(function(a){configuration.set(a,this.value());}).bind(e.trackbar,i));var j=eval(e.getAttribute(a.DEFAULT_VALUE_ATTR));if(isNaN(j))j=f;e.trackbar.setValue(configuration.get(i,j));}}});return a;})();exports.translation=(function(){var a={TRANSLATION_ATTRIBUTE:"x-tr"};a.get=function(b){if(a.catalog&&a.catalog.texts)return a.catalog.texts[b];};a.translate=function(b){return a.get(b)||b;};a.translateN=function(b){var c=arguments[arguments.length-1];var d=a.pluralizer(c);var e=a.get(b);if(e instanceof Array)return e[d];else return arguments[d];};addEventListener("load",function(){a.pluralizer=function(b){if(!a.catalog)return;var c=eval(a.catalog.plural);if(c===true)return 1;else if(c===false)return 0;else if(typeof c=="number")return c;else throw "Invalid plural value: "+c;};var b=document.evaluate("//*[@"+a.TRANSLATION_ATTRIBUTE+"]",document,null,XPathResult.ANY_TYPE,null);var c;var d=[];while(c=b.iterateNext()){c.normalize();d.push(c);}for(c=0;c<d.length;c++)d[c].innerHTML=a.translate(d[c].innerHTML.trim().split(/\s+/).join(" "));document.dispatchEvent(new CustomEvent("translated",{}));});return a;})();_=exports.translation.translate;_N=exports.translation.translateN;exports.app=(function(){var a={};if(checks.failures.length>0){addEventListener("load",features.listMissing);return;}if(window.applicationCache)applicationCache.addEventListener("updateready",function(a){if(applicationCache.status==applicationCache.UPDATEREADY)document.location.reload();},false);var b,c,d;a.ws={onOpen:function(){c=new controller.Touchpad(b);d=new controller.Keyboard(b);document.body.classList.add("connected");},onClose:function(){c=undefined;if(document.body.classList.contains("error"))messagebox.show(_("Failed to connect. If you have turned <em>Require QR code "+"scan for connections</em> on, please click <em>Connect "+"mobile device...</em> in the main menu and scan the QR "+"code to connect."),["error"]);else{messagebox.show(_("Connection closed. Please click "+"<a href='javascript:location.reload();'>here</a> to "+"reconnect."),["error"]);document.body.classList.remove("connected");}},onError:function(a){messagebox.show(_("Failed to connect. Please verify that ${host} is running.").format(util.mapSupplier({host:document.location.host})),["error"]);document.body.classList.remove("connected");document.body.classList.add("error");},onMessage:function(a){var b,c,d,e,f,g;try{var h=JSON.parse(a.data);b=h.reason;c="${exception} (${data}), ${reason}".format(util.mapSupplier({exception:h.exception,data:h.data.trim(),reason:b}));d=h.tb;}catch(i){b="unknown";c=a.data;}e=document.createElement("div");switch(b){case "invalid_command":case "invalid_data":f=_("Failed to send command: <code>${message}</code>.").format(util.mapSupplier({message:c.xmlEscape()}));break;case "internal_error":f=_("An error occurred on ${host}: <code>${message}</code>.").format(util.mapSupplier({host:document.location.host,message:c.xmlEscape()}));break;default:f=_("An unknown error occurred: <code>${message}</code>.").format(util.mapSupplier({message:c.xmlEscape()}));break;}e.innerHTML=f;if(d){var j;function k(a){j=document.createElement("tr");a.appendChild(j);}function l(a){var b=document.createElement("td");b.appendChild(document.createTextNode(a));j.appendChild(b);}g=document.createElement("table");g.classList.add("stack");g.classList.add("collapsed");var m=document.createElement("caption");m.appendChild(document.createTextNode(_("Stack trace")));m.addEventListener("click",function(){g.classList.toggle("collapsed");});g.appendChild(m);for(var n=0;n<d.length;n++){k(g);l(d[n][0].substring(d[n][0].indexOf("virtualtouchpad")));l(d[n][1]);l(d[n][2]);l(d[n][3]);}e.appendChild(g);}messagebox.show(e,["error"]);}};addEventListener("load",function(){b=new WebSocket("ws://${host}/controller".format(util.mapSupplier(document.location))+(document.location.hash?"?access_token="+document.location.hash.substring(1):""));b.onopen=app.ws.onOpen;b.onclose=app.ws.onClose;b.onerror=app.ws.onError;b.onmessage=app.ws.onMessage;});a.touchpad={onButtonDown:function(a){if(c)c.buttonDown(a);},onButtonUp:function(a){if(c)c.buttonUp(a);},onMove:function(a,b){if(c)c.move(a,b);},onScroll:function(a,b){if(c)c.scroll(a,b);}};a.keyboard={onPress:function(a,b,c){if(d)d.press(a,b,c);},onRelease:function(a,b,c){if(d)d.release(a,b,c);},onAction:function(a){var b=new XMLHttpRequest();b.open("GET","/keyboard/layout/",true);b.send();b.onload=(function(a){var c=JSON.parse(b.responseText);var d=c.layouts;var e=document.createElement("select");for(var f=0;f<d.length;f++){var g=d[f];var h=document.createElement("option");h.setAttribute("value",g.url);h.appendChild(document.createTextNode(g.name));e.appendChild(h);if(g.name===this.keyboard.layoutName)e.value=g.url;}document.body.appendChild(e);e.addEventListener("focusout",(function(a){a.parentElement.removeChild(a);}).bind(this,e));e.addEventListener("change",(function(a){if(this.keyboard.layout!=a.value)this.keyboard.layout=a.value;try{a.parentElement.removeChild(a);}catch(b){}}).bind(this,e));var i=document.createEvent("MouseEvents");i.initMouseEvent("mousedown",true,true,window);e.focus();e.dispatchEvent(i);}).bind(this);}};a.toolbar={onHelp:function(){window.open("help","_blank");},onSettings:function(){if(!app.settings.visible())app.settings.show();else app.settings.hide();},onFullscreenOn:function(){document.documentElement.requestFullscreen();}};addEventListener("load",function(){if(checks.failed("SVG")){var a=document.querySelector("#toolbar");a.parentElement.removeChild(a);return;}});var e,f;a.settings={TOGGLED_CLASS:"toggled",SLIDING_CLASS:"sliding",show:function(){e.classList.add(app.settings.TOGGLED_CLASS);f.classList.add(app.settings.TOGGLED_CLASS);},visible:function(){return f.classList.contains(app.settings.TOGGLED_CLASS);},slideBegin:function(){f.classList.add(app.settings.SLIDING_CLASS);},slideEnd:function(){f.classList.remove(app.settings.SLIDING_CLASS);},hide:function(){e.classList.remove(app.settings.TOGGLED_CLASS);f.classList.remove(app.settings.TOGGLED_CLASS);}};addEventListener("load",function(){var a,b;var c=0;function d(b){return b.screenX-a.screenX;}e=document.getElementById("settings-overlay");e.addEventListener("touchstart",function(b){app.settings.slideBegin();a=util.cloneTouches(b.touches)[0];});e.addEventListener("touchmove",function(c){var e=c.changedTouches.identifiedTouch(a.identifier);if(!e)return;b=e;var g=d(b).toFixed(0);if(g>0)g=0;f.style.marginLeft=g+"px";});e.addEventListener("touchend",function(a){var c=d(b)/f.clientWidth;if(c<-0.15)app.settings.hide();else if(c>0.5)app.settings.show();else if(app.settings.visible())app.settings.show();else app.settings.hide();f.removeAttribute("style");app.settings.slideEnd();});f=document.getElementById("settings-view");f.addEventListener("touchstart",function(a){a.preventDefault();});});return a;})();]]></script></head><body><x-message-box id="message-box"></x-message-box><x-touchpad id="touchpad" onbuttondown="app.touchpad.onButtonDown.apply(this, event.detail);" onbuttonup="app.touchpad.onButtonUp.apply(this, event.detail);" onmove="app.touchpad.onMove.apply(this, event.detail);" onscroll="app.touchpad.onScroll.apply(this, event.detail);"></x-touchpad><div id="settings-overlay"></div><div id="settings-view"><div><span x-tr="">Sensitivity</span><x-trackbar default-value="0.5" max-value="1.0" min-value="0.3" property="view.sensitivity"></x-trackbar></div><div><span x-tr="">Acceleration</span><x-trackbar default-value="0.5" max-value="1.0" min-value="0.2" property="view.acceleration"></x-trackbar></div></div><div class="toolbar" id="toolbar"><x-button class="help" onclick="app.toolbar.onHelp();"><svg height="44" version="1.1" width="44" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><circle class="frame" cx="22" cy="22" r="20"/><text dominant-baseline="central" text-anchor="middle" x="22" y="22">?</text></svg></x-button><x-button class="settings" onclick="app.toolbar.onSettings();"><svg height="44" version="1.1" width="44" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><line x1="6" x2="38" y1="12" y2="12"/><line x1="6" x2="38" y1="22" y2="22"/><line x1="6" x2="38" y1="32" y2="32"/></svg></x-button><x-button class="fullscreen on" onclick="app.toolbar.onFullscreenOn();"><svg height="44" version="1.1" width="44" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M 0,6 l 0,-6 l 6,0 M 0,0 l 8,8" id="arrow"/></defs><rect class="frame" height="40" rx="2" ry="2" width="40" x="2" y="2"/><use transform="rotate(0 22 22)" x="8" xlink:href="#arrow" y="8"/><use transform="rotate(90 22 22)" x="8" xlink:href="#arrow" y="8"/><use transform="rotate(180 22 22)" x="8" xlink:href="#arrow" y="8"/><use transform="rotate(270 22 22)" x="8" xlink:href="#arrow" y="8"/></svg></x-button></div><svg version="1.1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><radialGradient cx="0.5" cy="0.7" gradientTransform="scale(2,1) translate(-0.25,0)" id="keyboard-shade" r="1"><stop offset="0" style="stop-color:#ffffff"/><stop offset="1" style="stop-color:#000000"/></radialGradient><!-- Drawings --><g id="keyboard-arrow"><path class="keyboard drawing" d="M -8,0 l 16,0 m -8,-4 l 8,4 l -8,4 z"/></g><g id="keyboard-arrow-stop"><line class="keyboard drawing" x1="8" x2="8" y1="4" y2="-4"/></g><g id="keyboard-shift"><path class="keyboard drawing shift" d="M 0,-9 l 9,9 l -3,0 l 0,3 l -12,0 l 0,-3 l -3,0 z"/></g><g id="keyboard-icon"><circle class="keyboard drawing" cx="-3" cy="3" r="2"/><circle class="keyboard drawing" cx="-2" cy="-3" r="2"/><circle class="keyboard drawing" cx="3" cy="4" r="2"/><circle class="keyboard drawing" cx="4" cy="-2" r="2"/></g><g id="keyboard-alternatives"><line class="keyboard drawing" x1="-4" x2="4" y1="-4" y2="-4"/><line class="keyboard drawing" x1="-4" x2="4" y1="0" y2="0"/><line class="keyboard drawing" x1="-4" x2="4" y1="4" y2="4"/></g><!-- Keys --><g id="keyboard-key"><rect class="keyboard background" height="24" rx="2" ry="2" width="26"/><rect class="keyboard overlay" height="24" rx="2" ry="2" width="26"/></g><g id="keyboard-backspace"><rect class="keyboard background backspace" height="24" rx="2" ry="2" width="50"/><rect class="keyboard overlay backspace" height="24" rx="2" ry="2" width="50"/><use transform="translate(25,12) rotate(180)" xlink:href="#keyboard-arrow"/></g><g id="keyboard-tab"><rect class="keyboard background tab" height="24" rx="2" ry="2" width="40"/><rect class="keyboard overlay tab" height="24" rx="2" ry="2" width="40"/><use transform="translate(20,12)" xlink:href="#keyboard-arrow"/><use transform="translate(20,12)" xlink:href="#keyboard-arrow-stop"/></g><g id="keyboard-enter"><path class="keyboard background enter" d="M 0,2 a 2,2,0,0,1,2,-2 l 32,0 a 2,2,0,0,1,2,2 l 0,48 a 2,2,0,0,1,-2,2 l -22,0 a 2,2,0,0,1,-2,-2 l 0,-24 a 2,2,0,0,0,-2,-2 l -6,0 a 2,2,0,0,1,-2,-2 z"/><path class="keyboard overlay enter" d="M 0,2 a 2,2,0,0,1,2,-2 l 32,0 a 2,2,0,0,1,2,2 l 0,48 a 2,2,0,0,1,-2,2 l -22,0 a 2,2,0,0,1,-2,-2 l 0,-24 a 2,2,0,0,0,-2,-2 l -6,0 a 2,2,0,0,1,-2,-2 z"/><use transform="translate(22,20) rotate(180)" xlink:href="#keyboard-arrow"/><use transform="translate(22,16)" xlink:href="#keyboard-arrow-stop"/></g><g id="keyboard-caps"><rect class="keyboard background caps special" height="24" rx="2" ry="2" width="50"/><rect class="keyboard overlay caps special" height="24" rx="2" ry="2" width="50"/><text class="keyboard small" text-anchor="middle" x="25" y="16">Caps</text></g><g id="keyboard-lshift"><rect class="keyboard background shift lshift special" height="24" rx="2" ry="2" width="28"/><rect class="keyboard overlay shift lshift special" height="24" rx="2" ry="2" width="28"/><use transform="translate(14,14)" xlink:href="#keyboard-shift"/></g><g id="keyboard-rshift"><rect class="keyboard background shift rshift special" height="24" rx="2" ry="2" width="78"/><rect class="keyboard overlay shift rshift special" height="24" rx="2" ry="2" width="78"/><use transform="translate(39,14)" xlink:href="#keyboard-shift"/></g><g id="keyboard-ctrl"><rect class="keyboard background ctrl special" height="24" rx="2" ry="2" width="28"/><rect class="keyboard overlay ctrl special" height="24" rx="2" ry="2" width="28"/><text class="keyboard small" text-anchor="middle" x="14" y="16">Ctrl</text></g><g id="keyboard-super"><rect class="keyboard background super" height="24" rx="2" ry="2" width="28"/><rect class="keyboard overlay super" height="24" rx="2" ry="2" width="28"/><use transform="translate(14,12)" xlink:href="#keyboard-icon"/></g><g id="keyboard-alt"><rect class="keyboard background alt special" height="24" rx="2" ry="2" width="28"/><rect class="keyboard overlay alt special" height="24" rx="2" ry="2" width="28"/><text class="keyboard small" text-anchor="middle" x="14" y="16">Alt</text></g><g id="keyboard-space"><rect class="keyboard background space" height="24" rx="2" ry="2" width="216"/><rect class="keyboard overlay space" height="24" rx="2" ry="2" width="216"/></g><g id="keyboard-altgr"><rect class="keyboard background altgr special" height="24" rx="2" ry="2" width="28"/><rect class="keyboard overlay altgr special" height="24" rx="2" ry="2" width="28"/><text class="keyboard small" text-anchor="middle" x="14" y="16">AltGr</text></g><g id="keyboard-menu"><rect class="keyboard background menu" height="24" rx="2" ry="2" width="28"/><rect class="keyboard overlay menu" height="24" rx="2" ry="2" width="28"/><use transform="translate(14,12)" xlink:href="#keyboard-alternatives"/></g><g id="keyboard-layout"><rect class="keyboard background layout" height="24" rx="2" ry="2" width="28"/><rect class="keyboard overlay layout" height="24" rx="2" ry="2" width="28"/><text class="keyboard small" text-anchor="middle" x="14" y="16">üåê</text></g></defs></svg><x-keyboard id="keyboard" layout="/keyboard/layout/default" onaction="app.keyboard.onAction.apply(this, event.detail);" onpress="app.keyboard.onPress.apply(this, event.detail);" onrelease="app.keyboard.onRelease.apply(this, event.detail);" src="/keyboard/geometry/large.svg"></x-keyboard><x-keyboard id="keyboard-func" onpress="app.keyboard.onPress.apply(this, event.detail);" onrelease="app.keyboard.onRelease.apply(this, event.detail);" src="/keyboard/geometry/function-keys.svg"></x-keyboard></body></html>